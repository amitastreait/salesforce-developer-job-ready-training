<template>
    <div class="content-card">
        <div class="card-header-section">
            <h2 class="card-title">Shopping Cart</h2>
            <p class="card-subtitle">Review items in your cart ({totalItems} items)</p>
        </div>
        <div class="card-body">
            <template if:true={hasCartItems}>
                <div class="cart-items-container">
                    <template for:each={cartItems} for:item="item">
                        <div key={item.id} class="cart-item-card">
                            <div class="cart-item-image">
                                <template if:true={item.propertyImage}>
                                    <img src={item.propertyImage} alt={item.propertyName} class="cart-image" />
                                </template>
                                <template if:false={item.propertyImage}>
                                    <div class="cart-image-placeholder">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                                        </svg>
                                    </div>
                                </template>
                            </div>
                            <div class="cart-item-details">
                                <h3 class="cart-item-name">{item.propertyName}</h3>
                                <template if:true={item.location}>
                                    <p class="cart-item-location">{item.location}</p>
                                </template>
                                <p class="cart-item-status">Status: {item.propertyStatus}</p>
                                <div class="cart-item-quantity">
                                    <label class="quantity-label">Quantity:</label>
                                    <lightning-input
                                        type="number"
                                        value={item.quantity}
                                        min="1"
                                        data-item-id={item.id}
                                        onchange={handleUpdateQuantity}
                                        class="quantity-input">
                                    </lightning-input>
                                </div>
                            </div>
                            <div class="cart-item-actions">
                                <div class="cart-item-pricing">
                                    <p class="cart-item-price">
                                        <lightning-formatted-number
                                            value={item.propertyPrice}
                                            format-style="currency"
                                            currency-code="USD">
                                        </lightning-formatted-number>
                                    </p>
                                    <template if:true={item.discount}>
                                        <p class="cart-item-discount">
                                            Discount: -<lightning-formatted-number
                                                value={item.discount}
                                                format-style="currency"
                                                currency-code="USD">
                                            </lightning-formatted-number>
                                        </p>
                                    </template>
                                    <p class="cart-item-total">
                                        Total: <lightning-formatted-number
                                            value={item.total}
                                            format-style="currency"
                                            currency-code="USD">
                                        </lightning-formatted-number>
                                    </p>
                                </div>
                                <div class="cart-item-buttons">
                                    <button
                                        class="btn-link"
                                        data-property-id={item.propertyId}
                                        onclick={handleViewCartItem}>
                                        View Details
                                    </button>
                                    <button
                                        class="btn-link btn-danger"
                                        data-item-id={item.id}
                                        onclick={handleRemoveCartItem}>
                                        Remove
                                    </button>
                                </div>
                            </div>
                        </div>
                    </template>

                    <!-- Cart Summary -->
                    <div class="cart-summary">
                        <div class="cart-summary-content">
                            <h3 class="cart-summary-title">Order Summary</h3>
                            <div class="cart-summary-row">
                                <span>Items ({totalItems}):</span>
                                <span>{cartTotalFormatted}</span>
                            </div>
                            <div class="cart-summary-row cart-summary-total">
                                <span>Total:</span>
                                <span class="total-amount">{cartTotalFormatted}</span>
                            </div>
                            <button class="btn-primary checkout-button" onclick={handleCheckout}>
                                Proceed to Checkout
                            </button>
                        </div>
                    </div>
                </div>
            </template>

            <template if:false={hasCartItems}>
                <div class="empty-state">
                    <svg class="empty-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                    </svg>
                    <h3 class="empty-title">Your Cart is Empty</h3>
                    <p class="empty-text">Add items to your cart to see them here.</p>
                    <button class="btn-primary" onclick={handleBrowseProducts}>Start Shopping</button>
                </div>
            </template>
        </div>
    </div>
</template>
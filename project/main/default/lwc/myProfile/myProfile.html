<template>
   <!-- Loading Spinner -->
    <template if:true={isLoading}>
        <div class="loading-container">
            <lightning-spinner alternative-text="Loading profile..." size="large"></lightning-spinner>
        </div>
    </template>
    <div class="profile-container">

        <!-- Error Message -->
        <template if:true={error}>
            <div class="error-banner">
                <lightning-icon icon-name="utility:error" size="small" variant="error"></lightning-icon>
                <span class="error-text">{error}</span>
            </div>
        </template>

        <!-- Main Profile Content -->
        <template if:false={isLoading}>

            <!-- Profile Header with Avatar -->
            <div class="profile-header">
                <div class="profile-header-content">
                    <div class="profile-avatar-section">
                        <div class="avatar-container">
                            <template if:true={profileData.personalInfo.photoUrl}>
                                <img src={profileData.personalInfo.photoUrl} alt="Profile" class="avatar-image" />
                            </template>
                            <template if:false={profileData.personalInfo.photoUrl}>
                                <div class="avatar-placeholder">
                                    <lightning-icon icon-name="standard:avatar" size="large"></lightning-icon>
                                </div>
                            </template>
                        </div>
                        <div class="profile-header-info">
                            <h1 class="profile-name">{profileData.personalInfo.name}</h1>
                            <p class="profile-email">{profileData.personalInfo.email}</p>
                            <template if:true={profileData.personalInfo.title}>
                                <p class="profile-title">{profileData.personalInfo.title}</p>
                            </template>
                        </div>
                    </div>
                    <div class="profile-actions">
                        <button class="btn-primary" onclick={handleEditProfile}>
                            <svg class="icon-small" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                            </svg>
                            Edit Profile
                        </button>
                    </div>
                </div>
            </div>

            <!-- Navigation Tabs -->
            <div class="tabs-container">
                <button class={personalInfoTabClass} onclick={handleTabChange} data-tab="personalInfo">
                    <svg class="tab-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                    </svg>
                    Personal Info
                </button>
                <button class={addressTabClass} onclick={handleTabChange} data-tab="address">
                    <svg class="tab-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                    Address
                </button>
                <button class={ordersTabClass} onclick={handleTabChange} data-tab="orders">
                    <svg class="tab-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
                    </svg>
                    Orders
                </button>
                <button class={cartTabClass} onclick={handleTabChange} data-tab="cart">
                    <svg class="tab-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                    </svg>
                    Cart
                </button>
                <button class={wishlistTabClass} onclick={handleTabChange} data-tab="wishlist">
                    <svg class="tab-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                    </svg>
                    Wishlist
                </button>
                <button class={settingsTabClass} onclick={handleTabChange} data-tab="settings">
                    <svg class="tab-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                    Settings
                </button>
            </div>

            <!-- Tab Content -->
            <div class="tab-content">

                <!-- Personal Information Tab -->
                <template if:true={isPersonalInfoTab}>
                    <c-personal-info-display personal-info={profileData.personalInfo}></c-personal-info-display>
                </template>

                <!-- Address Tab -->
                <template if:true={isAddressTab}>
                    <c-address-display address={profileData.address}></c-address-display>
                </template>

                <!-- Orders Tab -->
                <template if:true={isOrdersTab}>
                    <c-order-list
                        orders={orders}
                        onvieworder={handleViewOrder}
                        onbrowseproducts={handleBrowseProducts}
                        onreorder={handleReorder}
                        ontrackorder={handleTrackOrder}>
                    </c-order-list>
                </template>

                <!-- Cart Tab -->
                <template if:true={isCartTab}>
                    <c-cart-display
                        cart-items={cartData.cartItems}
                        total-items={cartData.totalItems}
                        total-amount={cartData.totalAmount}
                        onupdatequantity={handleUpdateQuantity}
                        onviewcartitem={handleViewCartItem}
                        onremovecartitem={handleRemoveCartItem}
                        oncheckout={handleCheckout}
                        onbrowseproducts={handleBrowseProducts}>
                    </c-cart-display>
                </template>

                <!-- Wishlist Tab -->
                <template if:true={isWishlistTab}>
                    <c-wishlist-display
                        wishlist-items={wishlistData.wishlistItems}
                        total-items={wishlistData.totalItems}
                        onremovewishlistitem={handleRemoveWishlistItem}
                        onviewwishlistitem={handleViewWishlistItem}
                        onaddtocartwishlist={handleAddToCartFromWishlist}
                        onbrowseproducts={handleBrowseProducts}>
                    </c-wishlist-display>
                </template>

                <!-- Settings Tab -->
                <template if:true={isSettingsTab}>
                    <div class="content-card">
                        <div class="card-header-section">
                            <h2 class="card-title">Account Settings</h2>
                            <p class="card-subtitle">Manage your account preferences</p>
                        </div>
                        <div class="card-body">
                            <div class="settings-list">
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <h3 class="setting-title">Email Notifications</h3>
                                        <p class="setting-description">Receive updates about your orders and account</p>
                                    </div>
                                    <lightning-input
                                        type="toggle"
                                        checked
                                        class="setting-toggle">
                                    </lightning-input>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <h3 class="setting-title">SMS Notifications</h3>
                                        <p class="setting-description">Get text messages for order updates</p>
                                    </div>
                                    <lightning-input
                                        type="toggle"
                                        class="setting-toggle">
                                    </lightning-input>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <h3 class="setting-title">Marketing Communications</h3>
                                        <p class="setting-description">Receive promotional offers and updates</p>
                                    </div>
                                    <lightning-input
                                        type="toggle"
                                        class="setting-toggle">
                                    </lightning-input>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <h3 class="setting-title">Password</h3>
                                        <p class="setting-description">Change your account password</p>
                                    </div>
                                    <button class="btn-secondary" onclick={handleChangePassword}>Change</button>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <h3 class="setting-title">Privacy Settings</h3>
                                        <p class="setting-description">Manage your privacy preferences</p>
                                    </div>
                                    <button class="btn-secondary" onclick={handlePrivacySettings}>Manage</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </template>

            </div>

        </template>

        <!-- Edit Profile Modal -->
        <template if:true={showEditModal}>
            <section role="dialog" tabindex="-1" class="modal-overlay">
                <div class="modal-container">
                    <div class="modal-header">
                        <h2 class="modal-title">Edit Profile</h2>
                        <button class="modal-close" onclick={handleCloseModal}>
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                    <div class="modal-body">
                        <lightning-input
                            label="Phone"
                            value={editData.phone}
                            data-field="phone"
                            onchange={handleInputChange}>
                        </lightning-input>
                        <lightning-input
                            label="Mobile"
                            value={editData.mobile}
                            data-field="mobile"
                            onchange={handleInputChange}>
                        </lightning-input>
                        <lightning-input
                            label="Title"
                            value={editData.title}
                            data-field="title"
                            onchange={handleInputChange}>
                        </lightning-input>
                        <lightning-input
                            label="Street"
                            value={editData.street}
                            data-field="street"
                            onchange={handleInputChange}>
                        </lightning-input>
                        <lightning-input
                            label="City"
                            value={editData.city}
                            data-field="city"
                            onchange={handleInputChange}>
                        </lightning-input>
                        <lightning-input
                            label="State"
                            value={editData.state}
                            data-field="state"
                            onchange={handleInputChange}>
                        </lightning-input>
                        <lightning-input
                            label="Postal Code"
                            value={editData.postalCode}
                            data-field="postalCode"
                            onchange={handleInputChange}>
                        </lightning-input>
                        <lightning-input
                            label="Country"
                            value={editData.country}
                            data-field="country"
                            onchange={handleInputChange}>
                        </lightning-input>
                    </div>
                    <div class="modal-footer">
                        <button class="btn-secondary" onclick={handleCloseModal}>Cancel</button>
                        <button class="btn-primary" onclick={handleSaveProfile}>Save Changes</button>
                    </div>
                </div>
            </section>
        </template>

    </div>
</template>
